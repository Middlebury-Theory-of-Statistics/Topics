---
title: "Lecture 05"
author: "Albert Y. Kim"
date: "February 29, 2016"
output: ioslides_presentation
---

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Install these packages first
library(dplyr)
library(ggplot2)
library(tidyr)
library(knitr)
```

```{r, echo=FALSE}
# Load GSS2002 Data
GSS2002 <- source("https://raw.githubusercontent.com/Middlebury-Theory-of-Statistics/Non-Public/master/Datasets/GSS2002.R?token=AEXL-xTzrmcdfXdPzpSaJMasd1XUMMb1ks5W1j6ZwA%3D%3D")

GSS2002 <- GSS2002$value %>% 
  tbl_df() %>% 
  select(Education, DeathPenalty) %>% 
  filter(
    !is.na(Education),
    !is.na(DeathPenalty)
  )
```



## Raw Data

Recall the original data:

```{r, echo=FALSE}
# Set random number generator seed value explicitly so we can replicate our 
# simulations
set.seed(2)
GSS2002_subset <- GSS2002 %>% 
  sample_n(6) 
GSS2002_subset %>% 
  kable()
```



## Permuted Data

As with the two-sample permutation test, we permute/shuffle:

```{r, echo=FALSE}
set.seed(79)
GSS2002_subset %>% 
  mutate(
    DeathPenalty = sample(DeathPenalty)
  ) %>% 
  kable()
```



## Permuted Data

As with the two-sample permutation test, we permute/shuffle:

```{r, echo=FALSE}
set.seed(67)
GSS2002_subset %>% 
  mutate(
    DeathPenalty = sample(DeathPenalty)
  ) %>% 
  kable()
```



## Permuted Data

As with the two-sample permutation test, we permute/shuffle:

```{r, echo=FALSE}
set.seed(76)
GSS2002_subset %>% 
  mutate(
    DeathPenalty = sample(DeathPenalty)
  ) %>% 
  kable()
```



## Permutation Tests

```{r, echo=FALSE, cache=TRUE}
#Use function created above to calcluate chi-square test statistic
observed <- chisq.test(table(GSS2002$Education, GSS2002$DeathPenalty))[[1]]

B <- 10^4-1
result <- numeric(B)

for(i in 1:B){
   perm <- GSS2002 %>% mutate(DeathPenalty = sample(DeathPenalty))
   result[i] <- chisq.test(table(perm$Education, perm$DeathPenalty))[[1]]
 }

xlab <- "chi-square statistic"
title <- "Distribution of chi-square statistic"

#Create a histogram
hist(result, xlab=xlab, main=title, breaks=20)
```



## Permutation Tests

```{r, echo=FALSE}
#Create a histogram
hist(result, xlab=xlab, main=title, breaks=20)
abline(v=observed, col="red", lwd=2)   
```



## Permutation Tests

```{r, echo=FALSE}
#Create a histogram
hist(result, xlab=xlab, main=title, prob=TRUE, breaks=20)
abline(v=observed, col="red", lwd=2)   
```



## Permutation Tests

```{r, echo=FALSE}
hist(result, xlab=xlab, main=title, prob=TRUE, breaks=20)
abline(v=observed, col="red", lwd=2) 
curve(dchisq(x, df=4), from=0, to=25, col="blue", add=T, lwd=2) 
```



## Permutation Tests

p-value

`r (sum(result >= observed)+1)/(B + 1)`





